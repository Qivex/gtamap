<html>
<head>

	<title>Simple Property Test</title>

  <script src="libs/vue.js"></script>

	<script type="module">
    var mydata = {
      id: "root",
      children: [
        {
          id: "child1",
          children: [
            {id: "child1a", initial:2},
            {id: "child1b", initial:4},
            {id: "child1c", initial:6}
          ]
        },
        {
          id: "child2",
          children: [
            {id: "child2a", initial:1},
            {id: "child2b", initial:2},
            {id: "child2c", initial:3}
          ]
        }
      ]
    }
    
    var Property = {
      name: "Property",
      template: "#property-template",
      props: {
        id: String,
        initial: Number
      },
      data() {
        return {
          count: this.initial
        }
      },
      watch: {
        count: function() { this.$parent.update() }
      },
      methods: {
        inc: function() { this.count++ },
        dec: function() { this.count-- }
      }
    }
    
    var Group = {
      name: "Group",
      template: "#group-template",
      components: {
        Group,
        Property
      },
      props: {
        id: String,
        children: Array
      },
      data() {
        return {count: 0}
      },
      watch: {
        count: function() { if (this.$parent !== this.$root) this.$parent.update() }
      },
      methods: {
        inc: function() { this.$refs.childcomponents.forEach(c => c.inc()) },
        dec: function() { this.$refs.childcomponents.forEach(c => c.dec()) },
        update: function() { this.count = this.$refs.childcomponents.reduce((sum, child) => sum + child.count, 0) }
      },
      mounted: function() { this.update() }
    }
    
    Vue.createApp({
      data() {
        return {mydata}
      },
      components: {
        Group,
        Property
      }
    }).mount("#root")
	</script>

	<style>
		ul {
			margin-left: 20px
		}
	</style>

</head>
<body>

  <div id="root">
    <group v-bind="mydata"></group>
  </div>

  <template id="property-template">
    <span>
      <button @click="inc()">+</button>
      <button @click="dec()">-</button>
      {{id}} = {{count}}
    </span>
  </template>

  <template id="group-template">
    <span>
      <button @click="inc()">+</button>
      <button @click="dec()">-</button>
      {{id}} = {{count}}
    </span>
    <ul>
      <li v-for="child in children">
        <component :is="child.children ? 'Group' : 'Property'" v-bind="child" ref="childcomponents"></component>
      </li>
    </ul>
  </template>

</body>
</html>