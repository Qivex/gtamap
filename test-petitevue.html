<html>
<head>

	<title>Simple Property Test</title>

  <script src="libs/petite-vue.js"></script>

	<script type="module">
    var mydata = {
      id: "root",
      children: [
        {
          id: "child1",
          children: [
            {id: "child1a", initial:2},
            {id: "child1b", initial:4},
            {id: "child1c", initial:6}
          ]
        },
        {
          id: "child2",
          children: [
            {id: "child2a", initial:1},
            {id: "child2b", initial:2},
            {id: "child2c", initial:3}
          ]
        }
      ]
    }
    
    function Property(context) {
      Object.assign(context, {
        $template: "#property-template",
        count: context.initial,
        inc: function() { this.count++ },
        dec: function() { this.count-- },
      })
      return context
    }
    
    function Group(context) {
      Object.assign(context, {
        $template: "#group-template",
        count: 0,
        inc: function() { this.children.forEach(c => c.inc()) },
        dec: function() { this.children.forEach(c => c.dec()) },
        update: function() {
          this.count = this.$refs.childcomponents.reduce((sum, child) => sum + child.count, 0)
          if (this.parent) this.parent.update()
        }
      })
      return context
    }
    
    PetiteVue.createApp({Property, Group, mydata}).mount("#root")
	</script>

	<style>
		ul {
			margin-left: 20px
		}
	</style>

</head>
<body>

  <div id="root" v-scope="Group(mydata)"></div>

  <template id="property-template">
    <span>
      <button @click="inc()">+</button>
      <button @click="dec()">-</button>
      {{id}} = {{count}}
    </span>
  </template>

  <template id="group-template">
    <span>
      <button @click="inc()">+</button>
      <button @click="dec()">-</button>
      {{id}} = {{count}}
    </span>
    <ul>
      <li v-for="child in children" v-scope="child.children ? Group(child) : Property(child)" ref="childcomponents" @vue:mounted="update"></li>
    </ul>
  </template>

</body>
</html>